language: go
sudo: required
go:
- 1.10.x
services:
- docker
stages:
- test
- name: push
  if: $QUAY_USERNAME != "" $QUAY_PASSWORD != ""
jobs:
  include:
  - stage: compile
    script:
    - echo $QUAY_USERNAME
    - printenv
    - cd $HOME/gopath/src/github.com/integr8ly/keycloak-operator && make setup test
  - stage: deploy
    script:
    - docker login --password "$QUAY_PASSWORD" --username "$QUAY_USERNAME" quay.io;
    - cd $HOME/gopath/src/github.com/integr8ly/keycloak-operator && make build-and-push
      TAG=$TRAVIS_COMMIT;
env:
  global:
  - secure: KWoz46FImze5qnFZIfKxGCPaZkk7u3YgQuxuje2nMxr7750rdUr7GJD4qeyXDIGv0spaoa9j3+R7mDlgl8Voo3tK5YylTwSUaaOhLQj+XngRqEDtTSctNGTgo1nr/MkdF+IjvRKB9F9D/9PAi5ekGa2JzHdxxcVs57WTJv4YZbcp2y5dKTJaptOvKclBu5KYY4eq/Yx+u8C0iy6NsaIszqI+WFYpJHOYKUfMTtrdBwvZTTQLROAWJk/cp5xyuXYO8wlzyGfC01/O9xolnTMl2juDnnMWARlTHDfPlb1dQbBBXojtWr66st+d3/xH3gX0LRLqcHRZcrzP4DhpCdg1Gb9LibnpiGOzg6o2Bu/9LeCiddG7BarxWpwxRhcAtUjddnLaG/ftyiU0WWJsTwGhJHTsQOkZ6ElrtFBrAmgmggQkkvbmQ34ce162rP0X+hH/Vy92o5qXnH77Tn1WpN8o2cm6zUz8+vlm7SeX7PRw0h7EFXdqrodn5Az+wc7mKkTQlph/U1tJyCoiSmQt0r83jKOHQ+7hvQCOfqYxy4yv60c9V8qPphM19SpodfMa0QbngRK0Ll9q1pSoq+zjpDca+t9omrmj+/VSUvoR2S6/3txPyXPVDKqykMrUN8g14HOj9MhZ6NWJ9XjAZIWHa85MsNUL4D10ee/tyE64tGFOQYc=
