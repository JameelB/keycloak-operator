language: go
sudo: required
go:
- 1.10.x
services:
- docker
stages:
- test
- name: push
  if: $QUAY_USERNAME != "" $QUAY_PASSWORD != ""
jobs:
  include:
  - stage: compile
    script:
    - echo $QUAY_USERNAME
    - printenv
    - cd $HOME/gopath/src/github.com/integr8ly/keycloak-operator && make setup test
  - stage: deploy
    script:
    - docker login --password "$QUAY_PASSWORD" --username "$QUAY_USERNAME" quay.io;
    - cd $HOME/gopath/src/github.com/integr8ly/keycloak-operator && make build-and-push
      TAG=$TRAVIS_COMMIT;
env:
  global:
    secure: LZbvULDZ3WEKgI6aIgemxBWmL5GCDq4nYsa4ROGuZvUvWMHSFMTFZeIm8YHc4qLkEVQlIvzQ0xnOfqFxc1MePstNdl39G8jvwwFt/HWn68T3Qs6u5FRiHrRaeJCdtcwv1FFN/MLHOeFLBmryKDKA8LU8ovuyK0au/z1Zip6Iw2XVDxuK661zUypugo2rT4dRhGSjhYEWiLud7lLEjMGtka454alYmotmgz+8DkB/md/Ha48uQWL0qolAfYTiSa21F50uIVkhGLSTK2SYhwV7xlUakk+ijtjAKlPh/4gxlF06yEr4StrPSJTdyk2EI8YhhSTVNaVg/ngFaHSsjbawdweELSIpv/HCybVktDD/lVspRnZ1IK2kHuNXm+luD9E9f2fqidlL4dd/P9DT8VhLG21NXa+Ou6XsesBfplsS8HGAWPBKX6oHfpofs8zh4KYwoF8Hz3L6m5oLRvp+megjJBmho0+Sf0p8CZZiu9z8UuTB4KQc5MpqxOqbm0u7kCqIkBa91upzO9fXI3SKo+/M3XJszs5Eb/6eC0LDEoeEaBUhZc9HAJbEa6mBN7p/VjHgyI/HknqAv2RpTi2nBjLy0Sfa7W4An1VBw7Cgv3om2GZxYtsMCUULNqVDCGo6de/nM8xGMqQQkJWit2XxL3TiGwQBkm8zJGHSWnbJvgLCaQE=
